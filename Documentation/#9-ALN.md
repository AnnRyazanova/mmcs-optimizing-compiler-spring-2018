### Название задачи

Структура графа потока управления (CFG), создание CFG по набору базовых блоков.

#### Постановка задачи

Предоставить возможность получить граф потока управления по набору базовых блоков.

#### Зависимости задач в графе задач

* Все задачи анализа на уровне CFG
* Все оптимизации на уровне CFG
* IDE

#### Теоретическая часть задачи

Граф потока управления -- множество всех возможных путей исполнения программы, представленное в виде графa.

В графе потока управления каждый узел графа соответствует базовому блоку.

В графе потока управления устанавливаются связи между подряд идущими базовыми блоками, кроме случая, когда  базовый блок завершается инструкцией перехода, а также между блоками в которых есть безусловный переход и блоками, куда этот переход ведет.

#### Практическая часть задачи (реализация)

* Был реализован класс `ControlFlowGraph`, который представляет собой простую обертку над массивом базовых блоков.
* В класс `BasicBlock` Были добавлены структуры для возможности установления связей между блоками.
* Был реализован метод построения связей между массивом базовых блоков.

Основная работа алгоритма состоит из двух этапов. На первом этапе происходит поиск `GoTo` (безусловных переходов) в последней строчке базового блока.

```algorithm
ConnectBasicBlocks(BBList)
    for i = 0 to size(BBList)
        bb = BBList[i]
        if lastLine(bb) is GoTo
            last = lastLine(bb)
            target = getTarget(last)
            targetNode = getNode(target)
            connect(bb, targetNode)
```

Таким образом мы устанавливаем явные связи между блоками с безусловными переходами и блоками, в которые эти переходы ведут.

Во второй части алгоритма происходит установление связей между идущими подряд базовыми блоками.

```algorithm
ConnectChainedBasicBlocks(BBList)
    for i = 0 to size(BBList) - 1
        current = BBList[i]
        next = BBList[i+1]
        if lastLine(cur) is GoTo
            continue
        connect(current, next)
```

Если в последней строке есть безусловный переход, то связи между блоками быть не может в силу семантики оператора `GoTo`.

#### Тесты

Трёхадресный код

```TA
	1) t1 = 3 - 5       | B1
    
	2) t2 = 10 + 2      | B2
    
	3) t3 = -1          | B3
	4) if 1 goto 3)	    |
	
        5) t4 = t3 + 1999   | B4
        6) if 2 goto 2)	    |
    
	7) t5 = 7 * 4       | B5
    8) t6 = 100 / 2         |
```

#### Пример работы

Граф потока управления

```CFG
		B1
		|
		|   ______
		v  /	  \
		B2 v	   \
		|   __	    |
		|  /   \    |	
		v /    /    |
		B3 <--      |
		|           /
		|          /
		|         /
		B4-------
		|
		|
		v
		B5
```
